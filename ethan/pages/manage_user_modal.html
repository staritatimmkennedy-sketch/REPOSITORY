<div id="manageUserModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-lg">
    <h2 id="manageUserModalTitle" class="text-lg font-bold mb-4"></h2>

    <?php
    // Fetch roles and courses, similar to add_user_modal.html
    require_once __DIR__ . '/../db.php';

    if (!isset($conn) || !($conn instanceof PDO)) {
        echo '<p class="text-red-500">Error: DB not available</p>';
        $allRoles = [];
        $allCourses = [];
    } else {
        $roleQuery_m = $conn->query("SELECT role_id, roleName FROM role ORDER BY roleName");
        $allRoles = $roleQuery_m->fetchAll(PDO::FETCH_ASSOC);

        $courseQuery_m = $conn->query("SELECT course_id, courseName FROM course ORDER BY courseName");
        $allCourses = $courseQuery_m->fetchAll(PDO::FETCH_ASSOC);
    }
    ?>

    <form id="manageUserForm" method="POST">
      <input type="hidden" name="user_id" id="manageUserId" />

      <div class="mb-3">
        <label>User ID</label>
        <input type="text" id="manageUser_idDisplay" readonly class="w-full border rounded px-3 py-2 bg-gray-100" />
      </div>

      <div class="mb-3">
        <label>Username</label>
        <input type="text" name="username_display" id="manageUserUsername" readonly class="w-full border rounded px-3 py-2 bg-gray-100" />
      </div>

      <div class="mb-3">
        <label>First Name <span class="text-red-500">*</span></label>
        <input type="text" name="first_name" id="manageUserFirstName" required class="w-full border rounded px-3 py-2" />
      </div>

      <div class="mb-3">
        <label>Last Name <span class="text-red-500">*</span></label>
        <input type="text" name="last_name" id="manageUserLastName" required class="w-full border rounded px-3 py-2" />
      </div>

      <div class="mb-3">
        <label>Middle Name</label>
        <input type="text" name="middle_name" id="manageUserMiddleName" class="w-full border rounded px-3 py-2" />
      </div>

      <div class="mb-3">
        <label>Role <span class="text-red-500">*</span></label>
        <select name="role" id="manageUserRole" required class="w-full border rounded px-3 py-2">
          <option value="">Select Role</option>
          <?php foreach ($allRoles as $role): ?>
            <option value="<?= htmlspecialchars($role['role_id']) ?>">
              <?= htmlspecialchars($role['roleName']) ?>
            </option>
          <?php endforeach; ?>
        </select>
      </div>

      <div class="mb-3">
        <label>Course <span class="text-red-500">*</span></label>
        <select name="course" id="manageUserCourse" required class="w-full border rounded px-3 py-2">
          <option value="">Select Course</option>
          <?php foreach ($allCourses as $course): ?>
            <option value="<?= htmlspecialchars($course['course_id']) ?>">
              <?= htmlspecialchars($course['courseName']) ?>
            </option>
          <?php endforeach; ?>
        </select>
      </div>

      <div class="mb-3">
        <label>Year Level <span class="text-red-500">*</span></label>
        <select name="year_level" id="manageUserYearLevel" required class="w-full border rounded px-3 py-2">
          <option value="">Select Year Level</option>
          <option value="1">1st Year</option>
          <option value="2">2nd Year</option>
          <option value="3">3rd Year</option>
          <option value="4">4th Year</option>
        </select>
      </div>

      <div class="form-actions flex justify-end space-x-2">
        <button type="button" id="cancelManageUser" class="cf-button bg-gray-300 text-gray-700">Cancel</button>
        <button type="submit" id="saveUserButton" class="cf-button bg-green-600 text-white">Save Changes</button>
      </div>
    </form>
  </div>
</div>